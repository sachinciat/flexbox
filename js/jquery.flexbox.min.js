(function(e){"use strict";e.fn.flexBox=function(t){var n={useCSS:true,easing:"ease",mode:"slide",speed:600,videomaxWidth:1140,vimeoColor:"CCCCCC",videoAutoplay:true,controls:true,hideControlOnEnd:true},r=e(this),i=r.children(),s,o=document.createTouch!==undefined||"ontouchstart"in window||"onmsgesturechange"in window||navigator.msMaxTouchPoints,u='<div id="flexBox-Gallery">						<div id="flexBox-slider"></div>						<div id="flexBox-close" class="close"><i aria-hidden="true" class="bUi-iCn-rMv-16"></i></div>					</div>',a,f,l,c,h,p,d,v;var m=e.extend(true,{},n,t);var g={init:function(){i.click(function(e){d=true;s=i.index(this);v=s;e.preventDefault();e.stopPropagation();y.init(s)})}};var y={init:function(e){this.start();this.build()},start:function(){this.structure();this.gesture();this.closeSlide()},build:function(){this.loadContent(s);this.goToSlide();this.setSlide(s)},structure:function(){e("body").append(u);a=e("#flexBox-Gallery");f=a.find("#flexBox-slider");if(this.doCss()&&m.mode=="slide"){f.css(c,"left "+m.speed+"ms "+m.easing+"")}var t="";i.each(function(){t+='<div class="flexBox-slide"></div>'});f.append(t);l=a.find(".flexBox-slide")},closeSlide:function(){var t=this;e("#flexBox-close").bind("click touchend",function(e){e.preventDefault();e.stopPropagation();t.destroy()})},doCss:function(){var e=function(){var e=["transition","WebkitTransition","MozTransition","OTransition","msTransition","KhtmlTransition"];var t=document.documentElement;for(var n=0;n<e.length;n++){if(e[n]in t.style){c=e[n].replace("Transition","").toLowerCase();c=="transition"?c="transition":c="-"+c+"-transition";return e[n]}}};if(m.useCSS&&e()){return true}return false},gesture:function(){if(o){var t=this,n=null,r=10,i={},s={};var u=e("#flexBox-caption, #flexBox-action");e("body").bind("touchstart",function(t){e(this).addClass("touching");s=t.originalEvent.targetTouches[0];i.pageX=t.originalEvent.targetTouches[0].pageX;e(".touching").bind("touchmove",function(e){e.preventDefault();e.stopPropagation();s=e.originalEvent.targetTouches[0]});return false}).bind("touchend",function(o){o.preventDefault();o.stopPropagation();n=s.pageX-i.pageX;if(n>=r){t.prevSlide()}else if(n<=-r){t.nextSlide()}e(".touching").off("touchmove").removeClass("touching")})}},isVideo:function(e){var t=e.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/);var n=e.match(/vimeo\.com\/([0-9]*)/);if(t||n)return true},loadVideo:function(e,t,n){var r=e.match(/watch\?v=([a-zA-Z0-9\-_]+)/);var i=e.match(/vimeo\.com\/([0-9]*)/);var s="";if(r){if(m.videoAutoplay==true&&t==true)t="?autoplay=1&rel=0&wmode=opaque";else t="?wmode=opaque";s='<iframe id="video'+n+'" width="560" height="315" src="//www.youtube.com/embed/'+r[1]+t+'" frameborder="0" allowfullscreen></iframe>'}else if(i){if(m.videoAutoplay==true&&t==true)t="autoplay=1&";else t="";s='<iframe id="video'+n+'" width="560" height="315"  src="http://player.vimeo.com/video/'+i[1]+"?"+t+"byline=0&portrait=0&color="+m.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}return'<div class="video_cont"><div class="video">'+s+"</div></div>"},loadContent:function(t){var n=this;var r,s,o,u=i.length-t;var a=i.eq(t).attr("data-src");if(!n.isVideo(a)){f.find(".flexBox-slide").eq(t).html('<img src="'+a+'" />');o=e("img")}else{f.find(".flexBox-slide").eq(t).html(n.loadVideo(a,true,t));o=e("iframe")}f.find(".flexBox-slide").eq(t).find(o).on("load",function(){for(r=0;r<=t-1;r++){var e=i.eq(t-r-1).attr("data-src");if(!n.isVideo(e)){f.find(".flexBox-slide").eq(t-r-1).html('<img src="'+e+'" />')}else{f.find(".flexBox-slide").eq(t-r-1).html(n.loadVideo(e,false,t-r-1))}}for(s=1;s<u;s++){var e=i.eq(t+s).attr("data-src");if(!n.isVideo(e)){f.find(".flexBox-slide").eq(t+s).html('<img src="'+e+'" />')}else{f.find(".flexBox-slide").eq(t+s).html(n.loadVideo(e,false,t+s))}}})},goToSlide:function(){var e=this;if(m.controls==true&&i.length>2){a.append('<div id="flexBox-action"><a id="flexBox-prev"></a><a id="flexBox-next"></a></div>');h=a.find("#flexBox-prev");p=a.find("#flexBox-next");h.bind("click touchend",function(t){t.preventDefault();t.stopPropagation();e.prevSlide()});p.bind("click touchend",function(t){t.preventDefault();t.stopPropagation();e.nextSlide()})}},nextSlide:function(){var t=this;s=l.index(l.eq(v));if(s+1<i.length){s++;t.setSlide(s)}else{if(m.mode=="slide"){f.addClass("rightSpring");setTimeout(function(){f.removeClass("rightSpring")},500)}else if(m.mode=="fade"){e("#bM-Gallery").find(".pager_cont").addClass("open")}}},prevSlide:function(){var t=this;s=l.index(l.eq(v));if(s>0){s--;t.setSlide(s)}else{if(m.mode=="slide"){f.addClass("leftSpring");setTimeout(function(){f.removeClass("leftSpring")},500)}else if(m.mode=="fade"){e("#bM-Gallery").find(".pager_cont").addClass("open")}}},setSlide:function(t){if(m.mode=="slide"){if(this.doCss()){f.css({left:-t*100+"%"})}else{f.animate({left:-t*100+"%"})}}else if(m.mode=="fade"){if(d){l.css({position:"absolute",left:"0"});if(this.doCss()){l.css(c,"opacity "+m.speed+"ms "+m.easing+"");l.css("opacity","0");l.eq(t).css("opacity","1")}else{l.fadeOut(100);l.eq(t).fadeIn(100)}}else{if(this.doCss()){l.eq(v).css("opacity","0");l.eq(t).css("opacity","1");}else{l.eq(v).fadeOut(m.speed);l.eq(t).fadeIn(m.speed)}}d=false}l.eq(v).removeClass("current");l.eq(t).addClass("current");e("#bM-Gallery .thumb").removeClass("active");e("#bM-Gallery .thumb").eq(t).addClass("active");if(m.control==true&&m.hideControlOnEnd==true){if(t==0){h.addClass("disabled")}else if(t==i.length-1){p.addClass("disabled")}else{h.add(p).removeClass("disabled")}}v=t},destroy:function(){var t=this;e(window).trigger("resize");e("html").removeClass("flexBox");e(window).unbind("keyup");e("body").unbind("touchstart");e("body").unbind("touchmove");e("body").unbind("touchend");f.unbind();a.remove()}};g.init()}})(jQuery)